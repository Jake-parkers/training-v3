
= Checking Database Consistency
:doctype: book
:toc: left
:toclevels: 3
:prevsecttitle: Changing the Database Location
:prevsect: 6
:currsect: 7
:nextsecttitle: Scripting to Manage a Neo4j Instance
:nextsect: 8
:experimental:
:imagesdir: ../images
:manual: http://neo4j.com/docs/operations-manual/4.0

////
ifdef::backend-html5[]

include::scripts.txt[]

endif::backend-html5[]
////

== About this module

Next, you will learn how to check the consistency of a Neo4j database.

At the end of this module, you should be able to:
[square]
* Use neo4j-admin to check the consistency of a Neo4j database.

== Checking the consistency of a database

A database's consistency could be compromised if a software or hardware failure has occurred that affects the Neo4j database.
You will learn later in this module about live backups, but if you have reason to believe that a specific database has been corrupted,  you can perform a consistency check on it.

The Neo4j database must be stopped to perform the consistency check.

Here is how you use the `neo4j-admin` tool to check the consistency of the database:

`neo4j-admin check-consistency --database=<database-name> --report-dir=report-location [--verbose]`

The database named _database-name_ is found in the Neo4j instance.
If the tool comes back with no error, then the database is consistent.
Otherwise, an error is returned and a report is written to _report-location_.
You can specify verbose reporting. See the https://neo4j.com/docs/operations-manual/4.0/tools/consistency-checker/[Neo4j Operations Manual] for more options. For example, you can check the consistency of a backup which is a best practice.

Suppose we had loaded the *movies2* database with `neo4j-admin`. Here is what a successful run of the consistency checker should produce:

image::ConsistentPassed.png[ConsistentPassed,width=1000,align=center]

No report is written to the reports directory because the consistency check passed.

=== Inconsistencies found

Here is an example of what an unsuccessful run of the consistency checker should produce:

image::Inconsistencies.png[Inconsistencies,width=1000,align=center]

If inconsistencies are found, a report is generated and placed in the directory specified for the report location.

Inconsistencies in a database are a serious matter that should be looked into with the help of Neo4j Technical Support. 

[.slide-title.has-gold-background.has-team-background]
== Exercise #7: Checking consistency of a database

//ifndef::backend-htlm5[]
Refer to the *Exercise Guide* for instructions.
//endif::[]

//ifdef::backend-htlm5[]
//include::exercises/Exercise07.adoc
//endif::[]

////
[.quiz]
== Check your understanding

=== Question 1

Suppose that you have installed Neo4j Enterprise Edition and have modified the name of the active database in the Neo4j configuration file. What tool and command do you run to create the new database?

Select the correct answer.

[%interactive.answers]
- [ ] `neo4j-admin create-database`
- [ ] `neo4j-admin initialize`
- [ ] `neo4j create-database`
- [x] `neo4j start`

=== Question 2

Suppose that you want the existing Neo4j database to have the name *ABCRecommendations.db*. Assuming that you have stopped the Neo4j instance, what steps must you perform to modify the name of the database, which currently has a default name of *graph.db*?

Select the correct answers.

[%interactive.answers]
- [x] Rename the *NEO4J_HOME/graph.db* directory to *NEO4J_HOME/ABCRecommendations.db*.
- [x] Modify *neo4j.conf* to use _dbms.active_database=ABCRecommendations.db_.
- [ ] Run `neo4j-admin rename graph.db ABCRecommendations.db`.
- [ ] Run `neo4j-admin move graph.db ABCRecommendations.db`.

=== Question 3

How do you copy a database that you want to give to another user?

Select the correct answer.

[%interactive.answers]
- [ ] With the Neo4j instance started, run `neo4j-admin copy` providing the location where the copy will be created.
- [ ] With the Neo4j instance stopped, run `neo4j-admin copy` providing the location where the copy will be created.
- [ ] With the Neo4j instance started, run `neo4j-admin dump` providing the location where the dump file will be created.
- [x] With the Neo4j instance stopped, run `neo4j-admin dump` providing the location where the dump file will be created.
////

== Summary

You should now be able to:

[square]
* Use neo4j-admin to check the consistency of a Neo4j database.

////
== Grade Quiz and Continue 

++++
<a class="next-section medium button" href="../part-4/">Continue to Module 4</a>
++++

ifdef::backend-html5[]

include::scripts-end.txt[]
++++
<script>
$( document ).ready(function() {
  Intercom('trackEvent','training-admin-view-part3');
});
</script>
++++

endif::backend-html5[]
////
